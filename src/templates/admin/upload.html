{% extends "layout.html" %}

{% block title %}Data Upload - KNA Historie{% endblock %}

{% block content %}
<div class="container px-4 py-5" style="max-width: 900px;">
    <div class="mb-4">
        <a href="{{ url_for('admin.index') }}" class="btn btn-outline-secondary">
            ‚Üê Terug naar Dashboard
        </a>
    </div>

    <h1 class="mb-4">Data Upload</h1>

    <!-- Progress Steps -->
    <div class="d-flex justify-content-between mb-5" style="max-width: 700px; margin: 0 auto;">
        <div class="text-center">
            <div id="step1-indicator" class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center fw-bold mx-auto mb-2" style="width: 48px; height: 48px; font-size: 1.25rem;">
                1
            </div>
            <div class="small fw-medium">Selecteer bestand</div>
        </div>
        <div class="flex-grow-1 border-top border-2 border-secondary align-self-center mx-3"></div>
        <div class="text-center">
            <div id="step2-indicator" class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center fw-bold mx-auto mb-2" style="width: 48px; height: 48px; font-size: 1.25rem;">
                2
            </div>
            <div class="small fw-medium text-muted">Valideer</div>
        </div>
        <div class="flex-grow-1 border-top border-2 border-secondary align-self-center mx-3"></div>
        <div class="text-center">
            <div id="step3-indicator" class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center fw-bold mx-auto mb-2" style="width: 48px; height: 48px; font-size: 1.25rem;">
                3
            </div>
            <div class="small fw-medium text-muted">Laden</div>
        </div>
    </div>

    <!-- Upload Area -->
    <div id="upload-section" class="card shadow-sm mb-5">
        <div class="card-header bg-light">
            <h5 class="mb-0">Stap 1: Selecteer Excel bestand</h5>
        </div>
        <div class="card-body">
            <div id="drop-zone" class="border border-2 border-dashed rounded-3 p-5 text-center bg-light-subtle">
                <svg class="mx-auto mb-3 text-secondary" width="64" height="64" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
                </svg>
                <p class="mb-2">Sleep je Excel bestand hierheen of</p>
                <label for="file-upload" class="btn btn-primary">
                    Kies bestand
                </label>
                <input type="file" id="file-upload" class="d-none" accept=".xlsx,.xls">
                <p class="small text-muted mt-3">Alleen .xlsx en .xls bestanden</p>
            </div>

            <div id="file-info" class="mt-4 d-none alert alert-info">
                <strong>Geselecteerd:</strong> <span id="file-name"></span><br>
                <small id="file-size" class="text-muted"></small>
            </div>

            <button id="validate-btn" class="btn btn-primary w-100 mt-4" disabled>
                Valideer bestand
            </button>
        </div>
    </div>

    <div id="validation-section" class="card shadow-sm mb-5 d-none">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Stap 2: Validatieresultaat</h5>
            <button class="btn btn-sm btn-outline-danger" onclick="cancelUpload()">
                Annuleren
            </button>
        </div>
        <div class="card-body" id="validation-results"></div>
        <div class="card-footer d-none" id="load-btn-container">
            <button id="load-btn" class="btn btn-success w-100">
                Data laden in database
            </button>
        </div>
    </div>

    <div id="load-section" class="card shadow-sm d-none">
        <div class="card-header bg-light">
            <h5 class="mb-0">Stap 3: Laadresultaat</h5>
        </div>
        <div class="card-body" id="load-results"></div>
        <div class="card-footer">
            <a href="{{ url_for('admin.index') }}" class="btn btn-primary w-100">
                Terug naar dashboard
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
    <script src="{{ url_for('static', filename='js/admin/upload.js') }}"></script>
{% endblock %}